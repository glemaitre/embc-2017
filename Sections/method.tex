\section{Methodology}\label{sec:chp6:method}

\subsection{Materials}

The \ac{mpmri} data are acquired from a cohort of patients with
higher-than-normal level of \ac{psa}.
Acquisition is achieved with a \SI{3}{\tesla} whole body
\ac{mri} scanner (Siemens Magnetom Trio TIM, Erlangen, Germany) using
sequences to obtain \ac{t2w}-\ac{mri}, \ac{dce}-\ac{mri},
\ac{dw}-\ac{mri}, and \ac{mrsi}.
In addition of the \ac{mri} examination, these patients also have undergone
a \ac{trus} guided-biopsy.
The dataset is composed of a total of 19 patients, 17 of which
have biopsies that were positive for \ac{cap} and 2 patients are considered
``healthy'' because they have negative biopsies.
In all 12 patients have a \ac{cap} in the \ac{pz}, 3 patients
have \ac{cap} in the \ac{cg}, 2 patients have invasive \ac{cap} in
both the \ac{pz} and the \ac{cg}, and 2 patients are considered
``healthy''.
An experienced radiologist segmented the prostate organ --- on
\ac{t2w}-\ac{mri}, \ac{dce}-\ac{mri}, and \ac{adc} --- as
well as the prostate zones --- i.e., \ac{pz} and \ac{cg} ---, and
\ac{cap} on the \ac{t2w}-\ac{mri}.
The full description and the data set are available at \acs*{iccvb}
website\footnote{\url{http://i2cvb.github.io/}}~\cite{Lemaitre2016thesis}.

\subsection{\acs*{cad} pipeline for \acs*{cap}}

Our \ac{mpmri} \ac{cad} system consists of 7 different steps:
pre-processing, segmentation, registration, feature detection, feature
balancing, feature selection/extraction, and finally classification.
%% It should be noted that \ac{cad} system designed deals with
%% multiparametric \ac{mri} data.

\subsubsection{Pre-processing}\label{subsec:chp6:method:PP}

Normalization is, a crucial step to reduce the inter-patient
variations which allows to improve the learning during the
classification stage.
However, the \ac{mri} modalities provide specific type of data --- static
\emph{vs.} dynamic information, images \emph{vs.} signals --- that
required a dedicated pre-processing.
Therefore, we pre-process differently the data:
\ac{t2w}-\ac{mri} is normalized using a Rician
a-priori that has been shown to be better than the traditional
$z$-score~\cite{lemaitre2016normalization}.
In contrast to \ac{t2w}-\ac{mri}, in \ac{adc} map the \ac{pdf} within the
prostate does not follow a known distribution and thus one cannot use
a parametric model to normalize these images and a non-parametric
piecewise-linear normalization~\cite{Nyul2000} is the best option for
this case.
\ac{dce}-\ac{mri} is a dynamic sequence and the data are normalized
based on a mean kinetic expression registration as proposed
in~\cite{Lemaitre2016thesis}.
Finally, the \ac{mrsi} modality has been pre-processed to correct the
phase, suppress the baseline, and align the frequencies~\cite{Parfait2012}.

\subsubsection{Segmentation and registration}\label{subsec:chp6:method:Seg-Reg}

For this work, our radiologist has manually segmented the prostate
organs on the different modalities.
However, the segmented prostate needs to be registered before to
extract features.
The \ac{t2w}-\ac{mri} is used as reference and each segmented prostate
in other modalities are registered to this reference.
Indeed, three registrations are used to correct: (i) the patient
motion during the \ac{dce}-\ac{mri} acquisition, (ii) the patient
motion between the \ac{t2w}-\ac{mri} and the \ac{dce}-\ac{mri}
acquisitions, and (iii) the patient motion between the
\ac{t2w}-\ac{mri} and the \ac{adc} map acquisition.
Additionally, volumes from all modalities have been interpolated to the
resolution of \ac{t2w}-\ac{mri}.

\subsubsection{Feature detection}\label{subsec:chp6:method:fea-det}
Similarly to the pre-processing, specific features are extracted
depending of the specificity of each \ac{mri} modality.
\begin{description}[style=unboxed,leftmargin=0cm]
\item[\ac{t2w}-\ac{mri} and \ac{adc} map features]
Additionally to the normalized intensity, edge- and texture-based
features are commonly extracted from \ac{t2w}-\ac{mri} and \ac{adc}
map.
The following set of filters characterizing edges have been used: (i)
Kirsch, (ii) Laplacian, (iii) Prewitt, (iv) Scharr, (v) Sobel, and
(vi) Gabor.
Except for the Kirsch filter, the other filters are applied in 3D,
taking advantage of the volume information instead of slice
information, as it is usually done.
Additionally, features based on phase congruency are
computed~\cite{kovesi1999image}.
To characterize the local texture, both second-order \ac{glcm}-based
features~\cite{Haralick1973} and rotation invariant and uniform
\ac{lbp}~\cite{ojala2002multiresolution} are extracted.
To encode 3D information, the 13 first Haralick features are computed
for the 13 possible directions.
For the same reason, the \ac{lbp} codes are computed for the
three-orthogonal-planes of each \ac{mri} volume.
All these features are extracted at each voxel of the volume.

\item[\ac{dce}-\ac{mri} features]
In brief, the entire enhanced signal, semi-quantitative~\cite{Huisman2001}, and
quantitative-based
models~\cite{brix1991pharmacokinetic,hoffmann1995pharmacokinetic,tofts1995quantitative,giannini2015fully}
are computed.

\item[\ac{mrsi} features]
Three different techniques are used to extract
discriminative features: (i) relative quantification based on
metabolite quantification, (ii) relative
quantification based on bounds integration, and (iii) spectra
extraction from \SIrange{2}{4}{\ppm}~\cite{Lemaitre2016thesis}.

\item[Anatomical features]
Four different metrics are computed based on the relative distance to the
prostate boundary as well as the prostate center, and the relative
position in the Euclidean and cylindrical coordinate
systems~\cite{Chen2002,Litjens2014}.

\end{description}

\subsubsection{Feature balancing}\label{subsec:chp6:method:fea-bal}
Imbalanced dataset is a common problem in medical imaging.
The number of cancerous voxels is much lower than the number of
``healthy'' voxels for a patient.
This problem compromises the learning process.
Solving the problem of imbalanced is equivalent to under- or
over-sampling part of the dataset to obtain equal number of samples
in both classes.
We used several methods and selected the most efficient for our
dataset~\cite{imblearn}.

\subsubsection{Feature selection and extraction}\label{subsec:chp6:method:fea-sel}

Feature selection and extraction are used in our experiment.
\ac{mrsi} and \ac{dce}-\ac{mri} are decomposed using three feature
extraction methods: \ac{pca}, sparse-\ac{pca}, and \ac{ica} are used
to decompose signal-based data.
Additionally to feature extraction, two methods of feature selection
are used: (i) the one-way \ac{anova} and (ii) the Gini importance
obtained while learning the \ac{rf} classifiers.

\subsubsection{Classification}\label{subsec:chp6:method:clas}

\ac{rf} has been chosen as our base classifier --- allowing for
feature selection as well --- to perform classification of individual
modality as well as the combination of modalities.
Additionally, we use stacking to create ensemble of base learners
using a meta-classifier~\cite{wolpert1992stacked}, namely \ac{adb} and \ac{gb}.
